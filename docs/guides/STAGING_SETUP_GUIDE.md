# Staging & Production Setup Guide

## The Simple Version

You have two versions of your app:
- **Production** (main branch) â†’ Real users see this
- **Staging** (dev branch) â†’ You test here first

## Step 1: Create the Dev Branch (1 minute)

```bash
# From your project root
git checkout -b dev
git push origin dev
```

Done! Now you have two branches in GitHub.

## Step 2: Railway Setup - Create Staging Backend (5 minutes)

### In Railway Dashboard:

1. **Create New Project**
   - Click "New Project"
   - Name it: `jason-coaching-backend-staging`
   
2. **Connect to GitHub**
   - Select your repository
   - **IMPORTANT**: Set branch to `dev` (not main!)
   
3. **Copy Environment Variables**
   - Go to your production Railway project
   - Copy all environment variables:
     - `OPENAI_API_KEY`
     - `JASON_VECTOR_STORE_ID`
     - `DEBUG_MODE` (set this to `true` for staging)
   - Paste them into your new staging project
   
4. **Deploy**
   - Railway will auto-deploy
   - Copy the staging URL (looks like: `https://jason-coaching-backend-staging.up.railway.app`)

### Configure Production Railway:

1. Go to your existing production Railway project
2. Settings â†’ Environment â†’ Source
3. Make sure it's connected to `main` branch ONLY

## Step 3: Vercel Setup (2 minutes)

### In Vercel Dashboard:

1. **Go to your project settings**
   
2. **Git Configuration**
   - Vercel automatically creates preview deployments for all branches
   - Your `main` branch = production (e.g., `jasoncoaching.com`)
   - Your `dev` branch = staging (e.g., `your-app-git-dev.vercel.app`)
   
3. **Environment Variables for Staging**
   - Go to Settings â†’ Environment Variables
   - For each variable, click the three dots
   - Make sure `Preview` is checked (this applies to dev branch)
   - Add a NEW variable specifically for dev branch:
     - Name: `VITE_API_BASE`
     - Value: `https://jason-coaching-backend-staging.up.railway.app/`
     - Environment: **Preview only** (uncheck Production and Development)

4. **Environment Variables for Production**
   - Keep your existing production variables
   - Make sure `VITE_API_BASE` for Production points to your production Railway URL
   - Or just leave it blank - your code already handles this!

## Step 4: Your Workflow (Daily Use)

### Working on New Features:

```bash
# Make sure you're on dev branch
git checkout dev

# Make your changes in Cursor
# Save files

# Push to GitHub
git add .
git commit -m "Added cool new feature"
git push origin dev
```

**What happens automatically:**
- âœ… Vercel deploys to staging URL (like `your-app-git-dev.vercel.app`)
- âœ… Railway staging backend updates
- âœ… You can test everything on staging URLs

### Deploy to Production (When Ready):

```bash
# Merge dev into main
git checkout main
git merge dev
git push origin main
```

**What happens automatically:**
- âœ… Vercel deploys to production URL
- âœ… Railway production backend updates
- âœ… Real users see your changes

## Your URLs Summary

After setup, you'll have:

**Production (main branch):**
- Frontend: `https://your-app.vercel.app` (your actual domain)
- Backend: `https://jason-coaching-backend-production.up.railway.app`

**Staging (dev branch):**
- Frontend: `https://your-app-git-dev.vercel.app` (auto-generated by Vercel)
- Backend: `https://jason-coaching-backend-staging.up.railway.app`

## Pro Tips

### 1. Always Work on Dev Branch
```bash
# Check which branch you're on
git branch

# If you're on main, switch to dev
git checkout dev
```

### 2. Test Before Merging
- Push to `dev`
- Test on staging URLs
- If it works â†’ merge to `main`
- If it breaks â†’ fix on `dev` branch, no harm to production!

### 3. Quick Reference Commands

```bash
# See all branches
git branch

# Switch branches
git checkout dev          # Switch to dev
git checkout main         # Switch to main

# Push changes
git push origin dev       # Push dev changes
git push origin main      # Push production changes

# Merge dev to main (when ready for production)
git checkout main
git merge dev
git push origin main
```

### 4. Environment Variables Cheat Sheet

**Frontend (Vercel):**
- `VITE_API_BASE` - Points to Railway backend
- `VITE_CHATKIT_API_DOMAIN_KEY` - Your ChatKit domain key

**Backend (Railway):**
- `OPENAI_API_KEY` - Your OpenAI key
- `JASON_VECTOR_STORE_ID` - Your vector store ID
- `DEBUG_MODE` - `true` for staging, `false` for production

## Troubleshooting

### "My staging site is showing production data"
- Check Railway staging environment variables
- Make sure you have separate databases (if using DB)

### "I pushed to dev but nothing deployed"
- Check Vercel dashboard for deployment logs
- Check Railway dashboard for build logs
- Make sure branches are connected properly

### "I accidentally pushed broken code to main"
- Don't panic!
- Git makes this easy to fix:
```bash
git checkout main
git revert HEAD
git push origin main
```
This reverts the last commit and redeploys the working version.

### "How do I see staging vs production in my browser?"
- Bookmark both URLs:
  - Staging: `https://your-app-git-dev.vercel.app`
  - Production: `https://your-app.vercel.app`
- Or use different browser profiles (Chrome profile 1 = staging, profile 2 = production)

## The Big Picture

```
Your Laptop (Cursor)
    â†“
    â†“ Push to GitHub
    â†“
GitHub Repository
    â†“
    â”œâ”€â”€â”€ main branch
    â”‚       â†“
    â”‚       â”œâ”€â†’ Vercel Production
    â”‚       â””â”€â†’ Railway Production
    â”‚
    â””â”€â”€â”€ dev branch
            â†“
            â”œâ”€â†’ Vercel Staging
            â””â”€â†’ Railway Staging
```

## Next Steps

1. âœ… Create `dev` branch
2. âœ… Set up Railway staging project
3. âœ… Configure Vercel environment variables
4. âœ… Test by pushing something small to `dev`
5. âœ… Verify staging URLs work
6. âœ… Merge to `main` when ready

---

**You're now running your app like a professional software company!** ðŸŽ‰

Questions? Just ask!

